name: ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å®šæœŸåé›†

on:
  schedule:
    # æ¯æ—¥åˆå‰9æ™‚ï¼ˆJSTï¼‰ã«å®Ÿè¡Œ = UTC 0æ™‚
    - cron: '0 0 * * *'
  
  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  workflow_dispatch:

jobs:
  collect-campaigns:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      
      - name: Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install requests beautifulsoup4 lxml
      
      - name: ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³åé›†å®Ÿè¡Œ
        run: |
          python -c "
          import sys
          sys.path.insert(0, '.')
          from app.collectors.campaign_collector import get_campaigns
          campaigns = get_campaigns(force_refresh=True)
          print(f'âœ… {len(campaigns)}ä»¶ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’åé›†')
          "
      
      - name: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆ
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add data/campaigns_cache.json
          git diff --quiet && git diff --staged --quiet || git commit -m "ğŸ¤– ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³è‡ªå‹•æ›´æ–° [skip ci]"
          git push
        continue-on-error: true
